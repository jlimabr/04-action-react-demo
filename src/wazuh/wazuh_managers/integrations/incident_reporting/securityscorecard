# #!/var/ossec/framework/python/bin/python3

# from importlib.util import spec_from_loader, module_from_spec
# from importlib.machinery import SourceFileLoader 
# from dateutil import tz

# import requests
# import json
# import datetime
# import pytz
# import os
# import re

# spec = spec_from_loader("slack_issues", SourceFileLoader("slack_issues", "/var/ossec/integrations/incident_reporting/jira"))
# slack_issues = module_from_spec(spec)
# spec.loader.exec_module(slack_issues)

# from_zone = tz.gettz('UTC')
# to_zone = tz.gettz('Europe/Lisbon')

# def parse(log):
#    source = 'SecurityScorecard'
#    siem_id = log['id']

#    summary = log['rule']['description']
#    title = summary
#    village = 'Cyber Defense'
#    team = 'Cyber Defense'
        
#    first_seen = datetime.datetime.strptime(log['data']['device']['first_seen'], '%Y-%m-%dT%H:%M:%SZ').replace(tzinfo=from_zone).astimezone(to_zone)
#    first_detected = datetime.datetime.strptime(log['timestamp'].split('+')[0].split('.')[0], '%Y-%m-%dT%H:%M:%S').replace(tzinfo=from_zone).astimezone(to_zone)
#    last_seen = datetime.datetime.strptime(log['data']['device']['last_seen'], '%Y-%m-%dT%H:%M:%SZ').replace(tzinfo=from_zone).astimezone(to_zone)

#    category = 'Other'
#    subcategory = 'Uncategorized'
#    impact = '4 - Low'
#    urgency = '4 - Low'
        
#    description = ''
#    description += '*Summary:* Security Scorecard ' + summary + '\n' 
#    description += '*Log Source:* ' + source + '\n'
#    description += '*SIEM ID/s:* ' + siem_id + '\n\n'
#    description += '*First seen:* ' + str(first_seen) + '\n'
#    description += '*First detected:* ' + str(first_detected) + '\n'
#    description += '*Last seen:* ' + str(last_seen) + '\n\n'
        
#    issue_key = slack_issues.create_issue(title, village, team, first_seen, first_detected, category, subcategory, impact, urgency, description)

#    if issue_key is None:
#        update_response = 'Failed to create issue.*'
#    else:
#        update_response = '*Issue created:* https://jira.jumia.com/browse/' + issue_key

#    description += update_response
   
#    return description